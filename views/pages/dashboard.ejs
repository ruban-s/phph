<body>
  <!-- Sidenav -->
  <% include ../partials/sidebar %>
  <!-- Main content -->
  <div class="main-content">
    <!-- Top navbar -->
    <% include ../partials/navbar %>
    <!-- Header -->
    <% include ../partials/header %>
    
    <!-- Page content -->
    <div class="container-fluid mt--7">
      <div class="row">
        <div class="col-xl-8 mb-5 mb-xl-0">
          <div class="card bg-gradient-default shadow">
            <div class="card-header bg-transparent">
              <div class="row align-items-center">
                <div class="col">
                  <h6 class="text-uppercase text-light ls-1 mb-1">Overview</h6>
                  <h2 class="text-white mb-0">Sales value</h2>
                </div>
                <div class="col">
                  <ul class="nav nav-pills justify-content-end">
                    <li class="nav-item mr-2 mr-md-0" data-toggle="chart" data-target="#chart-sales" data-update='{"data":{"datasets":[{"data":[0, 20, 10, 30, 15, 40, 20, 60, 60]}]}}' data-prefix="$" data-suffix="k">
                      <a href="#" class="nav-link py-2 px-3 active" data-toggle="tab">
                        <span class="d-none d-md-block">Month</span>
                        <span class="d-md-none">M</span>
                      </a>
                    </li>
                    <li class="nav-item" data-toggle="chart" data-target="#chart-sales" data-update='{"data":{"datasets":[{"data":[0, 20, 5, 25, 10, 30, 15, 40, 40]}]}}' data-prefix="$" data-suffix="k">
                      <a href="#" class="nav-link py-2 px-3" data-toggle="tab">
                        <span class="d-none d-md-block">Week</span>
                        <span class="d-md-none">W</span>
                      </a>
                    </li>
                  </ul>
                </div>
              </div>
            </div>
            <div class="card-body">
              <!-- Chart -->
              <div class="chart">
                <!-- Chart wrapper -->
                <canvas id="chart-sales" class="chart-canvas"></canvas>
              </div>
            </div>
          </div>
        </div>
        <div class="col-xl-4">
          <div class="card shadow">
            <div class="card-header bg-transparent">
              <div class="row align-items-center">
                <div class="col">
                  <h6 class="text-uppercase text-muted ls-1 mb-1">Performance</h6>
                  <h2 class="mb-0">Total orders</h2>
                </div>
              </div>
            </div>
            <div class="card-body">
              <!-- Chart -->
              <div class="chart">
                <canvas id="chart-orders" class="chart-canvas"></canvas>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="row mt-5">
        <div class="col-xl-8 mb-5 mb-xl-0">
          <div class="card shadow">
            <div class="card-header border-0">
              <div class="row align-items-center">
                <div class="col">
                  <h3 class="mb-0">Page visits</h3>
                </div>
                <div class="col text-right">
                  <a href="#!" class="btn btn-sm btn-primary">See all</a>
                </div>
              </div>
            </div>
            <div class="table-responsive">
              <!-- Projects table -->
              <table class="table align-items-center table-flush">
                <thead class="thead-light">
                  <tr>
                    <th scope="col">Page name</th>
                    <th scope="col">Visitors</th>
                    <th scope="col">Unique users</th>
                    <th scope="col">Bounce rate</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <th scope="row">
                      /argon/
                    </th>
                    <td>
                      4,569
                    </td>
                    <td>
                      340
                    </td>
                    <td>
                      <i class="fas fa-arrow-up text-success mr-3"></i> 46,53%
                    </td>
                  </tr>
                  <tr>
                    <th scope="row">
                      /argon/index.html
                    </th>
                    <td>
                      3,985
                    </td>
                    <td>
                      319
                    </td>
                    <td>
                      <i class="fas fa-arrow-down text-warning mr-3"></i> 46,53%
                    </td>
                  </tr>
                  <tr>
                    <th scope="row">
                      /argon/charts.html
                    </th>
                    <td>
                      3,513
                    </td>
                    <td>
                      294
                    </td>
                    <td>
                      <i class="fas fa-arrow-down text-warning mr-3"></i> 36,49%
                    </td>
                  </tr>
                  <tr>
                    <th scope="row">
                      /argon/tables.html
                    </th>
                    <td>
                      2,050
                    </td>
                    <td>
                      147
                    </td>
                    <td>
                      <i class="fas fa-arrow-up text-success mr-3"></i> 50,87%
                    </td>
                  </tr>
                  <tr>
                    <th scope="row">
                      /argon/profile.html
                    </th>
                    <td>
                      1,795
                    </td>
                    <td>
                      190
                    </td>
                    <td>
                      <i class="fas fa-arrow-down text-danger mr-3"></i> 46,53%
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
        <div class="col-xl-4">
          <div class="card shadow">
            <div class="card-header border-0">
              <div class="row align-items-center">
                <div class="col">
                  <h3 class="mb-0">Social traffic</h3>
                </div>
                <div class="col text-right">
                  <a href="#!" class="btn btn-sm btn-primary">See all</a>
                </div>
              </div>
            </div>
            <div class="table-responsive">
              <!-- Projects table -->
              <table class="table align-items-center table-flush">
                <thead class="thead-light">
                  <tr>
                    <th scope="col">Referral</th>
                    <th scope="col">Visitors</th>
                    <th scope="col"></th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <th scope="row">
                      Facebook
                    </th>
                    <td>
                      1,480
                    </td>
                    <td>
                      <div class="d-flex align-items-center">
                        <span class="mr-2">60%</span>
                        <div>
                          <div class="progress">
                            <div class="progress-bar bg-gradient-danger" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: 60%;"></div>
                          </div>
                        </div>
                      </div>
                    </td>
                  </tr>
                  <tr>
                    <th scope="row">
                      Facebook
                    </th>
                    <td>
                      5,480
                    </td>
                    <td>
                      <div class="d-flex align-items-center">
                        <span class="mr-2">70%</span>
                        <div>
                          <div class="progress">
                            <div class="progress-bar bg-gradient-success" role="progressbar" aria-valuenow="70" aria-valuemin="0" aria-valuemax="100" style="width: 70%;"></div>
                          </div>
                        </div>
                      </div>
                    </td>
                  </tr>
                  <tr>
                    <th scope="row">
                      Google
                    </th>
                    <td>
                      4,807
                    </td>
                    <td>
                      <div class="d-flex align-items-center">
                        <span class="mr-2">80%</span>
                        <div>
                          <div class="progress">
                            <div class="progress-bar bg-gradient-primary" role="progressbar" aria-valuenow="80" aria-valuemin="0" aria-valuemax="100" style="width: 80%;"></div>
                          </div>
                        </div>
                      </div>
                    </td>
                  </tr>
                  <tr>
                    <th scope="row">
                      Instagram
                    </th>
                    <td>
                      3,678
                    </td>
                    <td>
                      <div class="d-flex align-items-center">
                        <span class="mr-2">75%</span>
                        <div>
                          <div class="progress">
                            <div class="progress-bar bg-gradient-info" role="progressbar" aria-valuenow="75" aria-valuemin="0" aria-valuemax="100" style="width: 75%;"></div>
                          </div>
                        </div>
                      </div>
                    </td>
                  </tr>
                  <tr>
                    <th scope="row">
                      twitter
                    </th>
                    <td>
                      2,645
                    </td>
                    <td>
                      <div class="d-flex align-items-center">
                        <span class="mr-2">30%</span>
                        <div>
                          <div class="progress">
                            <div class="progress-bar bg-gradient-warning" role="progressbar" aria-valuenow="30" aria-valuemin="0" aria-valuemax="100" style="width: 30%;"></div>
                          </div>
                        </div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
        <div class="row mt-5">
          <div class="col-xl-12 mb-5 mb-xl-0">
            <div class="card bg-transparent-default shadow">
              <div class="card-header bg-transparent">
                <div class="row align-items-center">
                 <div id="chartdiv"></div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Styles -->
<style>
  #chartdiv {
    width: 100%;
    height: 800px;
  }
  </style>
  
  <!-- Resources -->
  <script src="https://www.amcharts.com/lib/4/core.js"></script>
  <script src="https://www.amcharts.com/lib/4/maps.js"></script>
  <script src="https://www.amcharts.com/lib/4/geodata/usaLow.js"></script>
  <script src="https://www.amcharts.com/lib/4/themes/animated.js"></script>
  
  <!-- Chart code -->
  <script>
  am4core.ready(function() {
  
  // Themes begin
  am4core.useTheme(am4themes_animated);
  // Themes end
  
  // Create map instance
  var chart = am4core.create("chartdiv", am4maps.MapChart);
  chart.maxZoomLevel = 64;
  
  // Set map definition
  chart.geodata = am4geodata_usaLow;
  
  // Set projection
  chart.projection = new am4maps.projections.AlbersUsa();
  
  // Add button
  var zoomOut = chart.tooltipContainer.createChild(am4core.ZoomOutButton);
  zoomOut.align = "right";
  zoomOut.valign = "top";
  zoomOut.margin(20, 20, 20, 20);
  zoomOut.events.on("hit", function() {
    if (currentSeries) {
      currentSeries.hide();
    }
    chart.goHome();
    zoomOut.hide();
    currentSeries = regionalSeries.US.series;
    currentSeries.show();
  });
  zoomOut.hide();
  
  
  // Create map polygon series
  var polygonSeries = chart.series.push(new am4maps.MapPolygonSeries());
  polygonSeries.useGeodata = true;
  polygonSeries.calculateVisualCenter = true;
  
  // Configure series
  var polygonTemplate = polygonSeries.mapPolygons.template;
  polygonTemplate.tooltipText = "{name}";
  polygonTemplate.fill = chart.colors.getIndex(0);
  
  // Load data when map polygons are ready
  chart.events.on("ready", loadStores);
  
  // Loads store data
  function loadStores() {
    var loader = new am4core.DataSource();
    loader.url = "https://s3-us-west-2.amazonaws.com/s.cdpn.io/t-160/TargetStores.json";
    loader.events.on("parseended", function(ev) {
      setupStores(ev.target.data);
    });
    loader.load();
  }
  
  // Creates a series
  function createSeries(heatfield) {
    var series = chart.series.push(new am4maps.MapImageSeries());
    series.dataFields.value = heatfield;
  
    var template = series.mapImages.template;
    template.verticalCenter = "middle";
    template.horizontalCenter = "middle";
    template.propertyFields.latitude = "lat";
    template.propertyFields.longitude = "long";
    template.tooltipText = "{name}:\n[bold]{stores} stores[/]";
  
    var circle = template.createChild(am4core.Circle);
    circle.radius = 10;
    circle.fillOpacity = 0.7;
    circle.verticalCenter = "middle";
    circle.horizontalCenter = "middle";
    circle.nonScaling = true;
  
    var label = template.createChild(am4core.Label);
    label.text = "{stores}";
    label.fill = am4core.color("#fff");
    label.verticalCenter = "middle";
    label.horizontalCenter = "middle";
    label.nonScaling = true;
  
    var heat = series.heatRules.push({
      target: circle,
      property: "radius",
      min: 10,
      max: 30
    });
  
    // Set up drill-down
    series.mapImages.template.events.on("hit", function(ev) {
  
      // Determine what we've clicked on
      var data = ev.target.dataItem.dataContext;
  
      // No id? Individual store - nothing to drill down to further
      if (!data.target) {
        return;
      }
  
      // Create actual series if it hasn't been yet created
      if (!regionalSeries[data.target].series) {
        regionalSeries[data.target].series = createSeries("count");
        regionalSeries[data.target].series.data = data.markerData;
      }
  
      // Hide current series
      if (currentSeries) {
        currentSeries.hide();
      }
  
      // Control zoom
      if (data.type == "state") {
        var statePolygon = polygonSeries.getPolygonById("US-" + data.state);
        chart.zoomToMapObject(statePolygon);
      }
      else if (data.type == "city") {
        chart.zoomToGeoPoint({
          latitude: data.lat,
          longitude: data.long
        }, 64, true);
      }
      zoomOut.show();
  
      // Show new targert series
      currentSeries = regionalSeries[data.target].series;
      currentSeries.show();
    });
  
    return series;
  }
  
  var regionalSeries = {};
  var currentSeries;
  
  function setupStores(data) {
  
    // Init country-level series
    regionalSeries.US = {
      markerData: [],
      series: createSeries("stores")
    };
  
    // Set current series
    currentSeries = regionalSeries.US.series;
  
    // Process data
    am4core.array.each(data.query_results, function(store) {
  
      // Get store data
      var store = {
        state: store.MAIL_ST_PROV_C,
        long: am4core.type.toNumber(store.LNGTD_I),
        lat: am4core.type.toNumber(store.LATTD_I),
        location: store.co_loc_n,
        city: store.mail_city_n,
        count: am4core.type.toNumber(store.count)
      };
  
      // Process state-level data
      if (regionalSeries[store.state] == undefined) {
        var statePolygon = polygonSeries.getPolygonById("US-" + store.state);
        if (statePolygon) {
  
          // Add state data
          regionalSeries[store.state] = {
            target: store.state,
            type: "state",
            name: statePolygon.dataItem.dataContext.name,
            count: store.count,
            stores: 1,
            lat: statePolygon.visualLatitude,
            long: statePolygon.visualLongitude,
            state: store.state,
            markerData: []
          };
          regionalSeries.US.markerData.push(regionalSeries[store.state]);
  
        }
        else {
          // State not found
          return;
        }
      }
      else {
        regionalSeries[store.state].stores++;
        regionalSeries[store.state].count += store.count;
      }
  
      // Process city-level data
      if (regionalSeries[store.city] == undefined) {
        regionalSeries[store.city] = {
          target: store.city,
          type: "city",
          name: store.city,
          count: store.count,
          stores: 1,
          lat: store.lat,
          long: store.long,
          state: store.state,
          markerData: []
        };
        regionalSeries[store.state].markerData.push(regionalSeries[store.city]);
      }
      else {
        regionalSeries[store.city].stores++;
        regionalSeries[store.city].count += store.count;
      }
  
      // Process individual store
      regionalSeries[store.city].markerData.push({
        name: store.location,
        count: store.count,
        stores: 1,
        lat: store.lat,
        long: store.long,
        state: store.state
      });
  
    });
  
    regionalSeries.US.series.data = regionalSeries.US.markerData;
  }
  
  }); // end am4core.ready()
  </script>
  
  <!-- HTML -->
  
      <!-- Footer -->
      <% include ../partials/footer %>
    </div>
  </div>
  <!-- Include scripts -->
  <% include ../partials/scripts %>
</body>

